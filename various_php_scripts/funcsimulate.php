<?

function funcfvLoop($setoran_per_bulan, $bunga_per_tahun_persen, $durasi_dlm_bulan) {
    $bunga_per_bulan = $bunga_per_tahun_persen/1200;
    $hasil = 0;
    for ($i = 1; $i <= $durasi_dlm_bulan; $i++) {
        $hasil = $setoran_per_bulan + $hasil*(1+$bunga_per_bulan);
    }
    return $hasil;
}

/*
Future Value Annuity
http://en.wikipedia.org/wiki/Future_value
*/
function funcfv($setoran_per_bulan, $bunga_per_tahun_persen, $durasi_dlm_bulan) {
    assert($bunga_per_tahun_persen > 0);
    $bunga_per_bulan = $bunga_per_tahun_persen/1200;
    return $setoran_per_bulan*( pow(1+$bunga_per_bulan, $durasi_dlm_bulan) - 1)/$bunga_per_bulan;
}


function test_funcfv() {
    $setoran_per_bulan = 1000000;
    $bunga_per_tahun_persen = 8;
    $test_result_str = <<<__END__
1000000.00
2006666.67
3020044.44
4040178.07
5067112.59
6100893.35
7141565.97
8189176.41
9243770.92
10305396.06
11374098.70
12449926.02
13532925.53
14623145.03
15720632.66
16825436.88
17937606.46
19057190.51
20184238.44
21318800.03
22460925.36
23610664.87
24768069.30
25933189.76
27106077.69
28286784.88
29475363.44
30671865.87
31876344.97
33088853.94
34309446.30
35538175.94
36775097.11
38020264.43
39273732.86
40535557.74
41805794.79
43084500.09
44371730.09
45667541.63
46971991.91
48285138.52
49607039.44
50937753.04
52277338.06
53625853.65
54983359.34
56349915.07
57725581.17
59110418.37
60504487.83
61907851.08
63320570.09
64742707.22
66174325.27
67615487.44
69066257.36
70526699.07
71996877.06
73476856.25
74966701.95
76466479.97
77976256.50
79496098.21
81026072.20
82566246.01
84116687.65
85677465.57
87248648.67
88830306.33
90422508.37
92025325.10
93638827.26
95263086.11
96898173.35
98544161.18
100201122.25
101869129.73
103548257.26
105238578.98
106940169.50
108653103.97
110377457.99
112113307.71
113860729.77
115619801.30
117390599.97
119173203.97
120967692.00
122774143.28
124592637.57
126423255.15
128266076.85
130121184.03
131988658.59
133868582.98
135761040.20
137666113.80
139583887.90
141514447.15
143457876.80
145414262.64
147383691.06
149366249.00
151362023.99
153371104.15
155393578.18
157429535.37
159479065.60
161542259.37
163619207.77
165710002.49
167814735.84
169933500.74
172066390.75
174213500.02
176374923.35
178550756.18
180741094.55
182946035.18
185165675.42
187400113.25
189649447.34
191913776.99
194193202.17
196487823.52
198797742.34
201123060.62
203463881.03
205820306.90
208192442.28
210580391.90
212984261.17
215404156.25
217840183.96
220292451.85
222761068.20
225246141.98
227747782.93
230266101.48
232801208.83
235353216.89
237922238.33
240508386.59
243111775.83
245732521.00
248370737.81
251026542.73
253700053.01
256391386.70
259100662.61
261828000.36
264573520.36
267337343.83
270119592.79
272920390.08
275739859.35
278578125.07
281435312.57
284311547.99
287206958.31
290121671.37
293055815.84
296009521.28
298982918.09
301976137.54
304989311.79
308022573.87
311076057.70
314149898.08
317244230.74
320359192.28
323494920.22
326651553.03
329829230.05
333028091.58
336248278.86
339489934.05
342753200.28
346038221.61
349345143.09
352674110.71
356025271.45
359398773.26
362794765.08
366213396.85
369654819.49
373119184.96
376606646.19
380117357.16
383651472.88
387209149.36
390790543.69
394395813.98
398025119.41
401678620.21
405356477.67
409058854.19
412785913.22
416537819.31
420314738.10
424116836.36
427944281.93
431797243.81
435675892.10
439580398.05
443510934.04
447467673.60
451450791.42
455460463.37
459496866.46
463560178.90
467650580.09
471768250.62
475913372.30
480086128.11
484286702.30
488515280.31
492772048.85
497057195.84
501370910.48
505713383.22
510084805.77
514485371.14
518915273.62
523374708.78
527863873.50
532382965.99
536932185.76
541511733.67
546121811.89
550762623.97
555434374.80
560137270.63
564871519.10
569637329.23
574434911.42
579264477.50
584126240.68
589020415.62
593947218.39
598906866.51
603899578.96
608925576.15
613985079.99
619078313.86
624205502.62
629366872.64
634562651.79
639793069.46
645058356.59
650358745.64
655694470.61
661065767.08
666472872.19
671916024.68
677395464.84
682911434.61
688464177.50
694053938.69
699680964.94
705345504.71
711047808.08
716788126.80
722566714.31
728383825.74
734239717.91
740134649.36
746068880.36
752042672.89
758056290.71
764109999.32
770204065.98
776338759.75
782514351.48
788731113.83
794989321.25
801289250.06
807631178.39
814015386.25
820442155.49
826911769.86
833424514.99
839980678.43
846580549.62
853224419.95
859912582.75
866645333.30
873422968.85
880245788.65
887114093.90
894028187.86
900988375.78
907994964.95
915048264.72
922148586.49
929296243.73
936491552.02
943734829.03
951026394.56
958366570.52
965755680.99
973194052.20
980682012.55
988219892.63
995808025.25
1003446745.42
1011136390.39
1018877299.66
1026669814.99
1034514280.42
1042411042.29
1050360449.24
1058362852.24
1066418604.58
1074528061.95
1082691582.36
1090909526.24
1099182256.42
1107510138.13
1115893539.05
1124332829.31
1132828381.50
1141380570.71
1149989774.52
1158656373.02
1167380748.84
1176163287.16
1185004375.74
1193904404.91
1202863767.61
1211882859.40
1220962078.46
1230101825.65
1239302504.49
1248564521.18
1257888284.66
1267274206.56
1276722701.27
1286234185.94
1295809080.51
1305447807.72
1315150793.10
1324918465.06
1334751254.82
1344649596.52
1354613927.17
1364644686.68
1374742317.92
1384907266.71
1395139981.82
1405440915.03
1415810521.13
1426249257.94
1436757586.33
1447335970.24
1457984876.71
1468704775.88
1479496141.06
1490359448.66
1501295178.32
1512303812.84
1523385838.26
1534541743.85
1545772022.14
1557077168.96
1568457683.42
1579914067.97
1591446828.43
1603056473.95
1614743517.11
1626508473.89
1638351863.72
1650274209.47
1662276037.54
1674357877.79
1686520263.64
1698763732.06
1711088823.61
1723496082.43
1735986056.32
1748559296.69
1761216358.67
1773957801.06
1786784186.40
1799696080.98
1812694054.85
1825778681.88
1838950539.76
1852210210.03
1865558278.09
1878995333.28
1892521968.84
1906138781.96
1919846373.84
1933645349.67
1947536318.67
1961519894.12
1975596693.42
1989767338.04
2004032453.63
2018392669.99
2032848621.12
2047400945.26
2062050284.89
2076797286.79
2091642602.04
2106586886.05
2121630798.63
2136775003.95
2152020170.64
2167366971.78
2182816084.93
2198368192.16
2214023980.11
2229784139.97
2245649367.57
2261620363.36
2277697832.45
2293882484.66
2310175034.56
2326576201.46
2343086709.47
2359707287.53
2376438669.45
2393281593.91
2410236804.54
2427305049.90
2444487083.57
2461783664.12
2479195555.22
2496723525.59
2514368349.09
2532130804.75
2550011676.78
2568011754.63
2586131832.99
2604372711.88
2622735196.62
2641220097.93
2659828231.92
2678560420.13
2697417489.60
2716400272.87
2735509608.02
2754746338.74
2774111314.33
2793605389.76
2813229425.69
2832984288.53
2852870850.45
2872889989.45
2893042589.38
2913329539.98
2933751736.91
2954310081.83
2975005482.37
2995838852.25
3016811111.27
3037923185.34
3059176006.58
3080570513.29
3102107650.05
3123788367.71
3145613623.50
3167584380.99
3189701610.19
3211966287.59
3234379396.18
3256941925.49
3279654871.66
3302519237.47
3325536032.38
3348706272.60
3372030981.08
3395511187.62
3419147928.88
3442942248.40
3466895196.72
3491007831.37
3515281216.91
3539716425.02
3564314534.52
3589076631.42
3614003808.96
3639097167.69
3664357815.47
3689786867.58
3715385446.70
3741154683.01
3767095714.23
3793209685.65
3819497750.23
3845961068.56
3872600809.02
3899418147.74
3926414268.73
3953590363.85
3980947632.95
4008487283.83
4036210532.39
4064118602.61
4092212726.63
4120494144.80
4148964105.77
4177623866.47
4206474692.25
4235517856.86
4264754642.58
4294186340.19
4323814249.13
4353639677.46
4383663941.97
4413888368.25
4444314290.71
4474943052.65
4505776006.33
4536814513.04
4568059943.13
4599513676.08
4631177100.59
4663051614.59
4695138625.35
4727439549.52
4759955813.19
4792688851.94
4825640110.95
4858811045.03
4892203118.66
4925817806.12
4959656591.49
4993720968.77
5028012441.90
5062532524.84
5097282741.67
5132264626.62
5167479724.13
5202929588.96
5238615786.22
5274539891.46
5310703490.73
5347108180.67
5383755568.54
5420647272.33
5457784920.82
5495170153.62
5532804621.31
5570689985.45
5608827918.69
5647220104.81
5685868238.85
5724774027.11
5763939187.29
5803365448.54
5843054551.53
5883008248.54
5923228303.53
5963716492.22
6004474602.16
6045504432.85
6086807795.73
6128386514.37
6170242424.46
6212377373.96
6254793223.12
6297491844.61
6340475123.57
6383744957.73
6427303257.45
6471151945.83
6515292958.80
6559728245.20
6604459766.83
6649489498.61
6694819428.60
6740451558.12
6786387901.84
6832630487.86
6879181357.78
6926042566.83
6973216183.94
7020704291.83
7068508987.11
7116632380.36
7165076596.23
7213843773.54
7262936065.36
7312355639.13
7362104676.72
7412185374.57
7462599943.73
7513350610.02
7564439614.09
7615869211.52
7667641672.93
7719759284.08
7772224345.97
7825039174.95
7878206102.78
7931727476.80
7985605659.98
8039843031.04
8094441984.58
8149404931.15
8204734297.36
8260432526.00
8316502076.18
8372945423.35
8429765059.51
8486963493.24
8544543249.86
8602506871.53
8660856917.34
8719595963.45
8778726603.21
8838251447.23
8898173123.54
8958494277.70
9019217572.89
9080345690.04
9141881327.97
9203827203.49
9266186051.51
9328960625.19
9392153696.03
9455768054.00
9519806507.69
9584271884.41
9649167030.31
9714494810.51
9780258109.25
9846459829.97
9913102895.51
9980190248.14
10047724849.80
10115709682.13
10184147746.68
10253042064.99
10322395678.76
10392211649.95
10462493060.95
10533243014.69
10604464634.78
10676161065.68
10748335472.79
10820991042.61
10894130982.89
10967758522.78
11041876912.93
11116489425.68
11191599355.19
11267210017.55
11343324751.00
11419946916.01
11497079895.45
11574727094.75
11652891942.05
11731577888.33
11810788407.59
11890526996.97
11970797176.95
12051602491.46
12132946508.07
12214832818.13
12297265036.92
12380246803.83
12463781782.52
12547873661.07
12632526152.14
12717742993.16
12803527946.45
12889884799.42
12976817364.75
13064329480.52
13152425010.39
13241107843.79
13330381896.08
13420251108.72
13510719449.45
13601790912.44
13693469518.53
13785759315.32
13878664377.42
13972188806.60
14066336731.98
14161112310.19
14256519725.59
14352563190.43
14449246945.03
14546575258.00
14644552426.39
14743182775.90
14842470661.07
14942420465.48
15043036601.91
15144323512.59
15246285669.34
15348927573.80
15452253757.63
15556268782.68
15660977241.23
15766383756.17
15872492981.21
15979309601.09
16086838331.76
16195083920.64
16304051146.78
16413744821.09
16524169786.57
16635330918.48
16747233124.60
16859881345.43
16973280554.40
17087435758.10
17202351996.48
17318034343.13
17434487905.41
17551717824.78
17669729276.95
17788527472.13
17908117655.27
18028505106.31
18149695140.35
18271693107.95
18394504395.34
18518134424.64
18642588654.14
18767872578.50
18893991729.03
19020951673.89
19148758018.38
19277416405.17
19406932514.53
19537312064.63
19668560811.73
19800684550.47
19933689114.14
20067580374.90
20202364244.07
20338046672.36
20474633650.18
20612131207.85
20750545415.90
20889882385.34
21030148267.91
21171349256.36
21313491584.74
21456581528.64
21600625405.49
21745629574.86
21891600438.70
22038544441.62
22186468071.23
22335377858.37
22485280377.43
22636182246.61
22788090128.26
22941010729.11
23094950800.64
23249917139.31
23405916586.90
23562956030.82
23721042404.36
23880182687.05
24040383904.96
24201653131.00
24363997485.20
24527424135.11
24691940296.01
24857553231.31
25024270252.86
25192098721.21
25361046046.02
25531119686.32
25702327150.90
25874675998.57
26048173838.56
26222828330.82
26398647186.36
26575638167.60
__END__;

    $test_results = explode("\n",$test_result_str);
    for ($durasi_dlm_bulan = 1; $durasi_dlm_bulan <= 780; $durasi_dlm_bulan++) {
        $funcres = funcfv($setoran_per_bulan, $bunga_per_tahun_persen, $durasi_dlm_bulan);
        //~ if (abs($funcres - $test_results[$durasi_dlm_bulan-1]) > 0.005)

        //since test data in 2 decimal precision, we round all value to 2 decimal precision
        $funcres = round($funcres,2);
        $testval = round($test_results[$durasi_dlm_bulan-1],2);
        //and test whether the rounded difference is > 0.01

        if (round(abs($funcres - $testval),2) > 0.01)
        {
            echo "# $durasi_dlm_bulan: $funcres should be $testval -> diff=".abs($funcres - $testval);
            die();
        }
    }
    echo 'Test pass.';
}

?>

